<source>
  @type tail
  @label @ids_alerts
  path /storage0/fortisiem/logdata_0_alert_*.json
  pos_file /tmp/t.log.pos
  #tag sentrywire_nsm_alerts
  tag swalerts
  format json
  path_key filename
</source>

<filter **>
  @type record_transformer
  enable_ruby
  <record>
    action ${record.dig('alert', 'action')}
    category ${record.dig('alert', 'category')}
    gid ${record.dig('alert', 'gid')}
    created_at ${record.dig('alert', 'metadata', 'created_at')&.first}
    updated_at ${record.dig('alert', 'metadata', 'updated_at')&.first}
    rev ${record.dig('alert', 'rev')}
    severity ${record.dig('alert', 'severity')}
    signature ${record.dig('alert', 'signature')}
    signature_id ${record.dig('alert', 'signature_id')}
    bytes_toclient ${record.dig('flow', 'bytes_toclient')}
    bytes_toserver ${record.dig('flow', 'bytes_toserver')}
    pkts_toclient ${record.dig('flow', 'pkts_toclient')}
    pkts_toserver ${record.dig('flow', 'pkts_toserver')}
    start ${record.dig('flow', 'start')}
  </record>
  remove_keys alert,flow
</filter>

<label @ids_alerts>
<match swalerts>
  @type copy
  <store>
    @type stdout
    output_type json
  </store>
  <store>
    @type remote_syslog
    host 10.1.55.188
    port 514
    protocol tcp
    program_key program
    message_key ${record.dig('filename')}: ${record.dig('message')}
    #hostname ${hostname}
    hostname
    facility user
    <format>
      @type json
    </format>
</store>
</match>
</label>
